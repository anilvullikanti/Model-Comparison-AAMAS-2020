\section{Framework}

Response surface methodology~\cite{box51response,carley04response}, also known as metamodel-based methods~\cite{barton06metamodel} for stochastic simulations is generally used for optimization~\cite{neddermeijer00response} and calibration~\cite{fadikar17emulation, lamperti18calibration}.


We denote the agent-based simulation model as a stochastic function, $F(\xi_1, \xi_2, ..., \xi_k)$, of its parameters, assuming a fixed initial condition. In response surface methodology, we generally fit the expected value of this function,
\begin{equation}
f(\xi_1, \xi_2, ..., \xi_k) = \mathbf{E}(F(\xi_1, \xi_2, ..., \xi_k)),
\end{equation}
where $F$ is the stochastic output, given parameters $\xi_1, \xi_2, ..., \xi_k$, and $\mathbf{E}$ denotes expectation. This is appropriate when the goal is optimization or calibration.

However, when we are using the ABM to model a specific observed phenomenon, as is the case in the scenarios described in Section~\ref{section:rooftop}, the real-world data represent only one stochastic realization of the model.
Therefore, instead of taking the expectation, we characterize the behavior of the ABM in terms of the probability of seeing a particular output given a particular
parameter setting. For ease of exposition, we assume that the simulation outputs one continuous variable, $y$, though the
formalism generalizes straightforwardly to multiple outputs. We relate $y$ to the parameters as follows.
\begin{equation}
P(y_{low} < y < y_{high}) = \int P(y_{low} < F < y_{high}|\Xi)P(\Xi),
\label{output_probability}
\end{equation}
where $\Xi = [\xi_1, \xi_2, ..., \xi_k]$, and $P(\Xi)$ is a prior probability over the parameter space. Thus, the ABM can be
characterized as a discretized probability distribution, using a set of bins denoted by their bin boundaries, $\{[y_0,y_1], [y_1,y_2], ..., [y_{n-1}, y_n]\}$.
The choice of bins depends on the domain of the model. For example, models of contagion processes exhibit sharp
transitions, which are a natural choice for bin boundaries in that case, as we will see in the experiments section. We
refer to this distribution as the \emph{characteristic distribution} for the ABM

We define the \emph{characteristic distance} between two ABMs as the distance between their characteristic distributions.
\begin{equation}
d(F_1, F_2) := D(P_1(y), P_2(y)).
\end{equation}
There are multiple valid choices for $D$, such as the (symmetric) KL-divergence, mean-squared distance, total variation distance, earth-mover's distance, etc. Note that this distance is well-defined even if the two ABMs have entirely different parameter spaces, since it is defined only over the output space. Thus it is a fairly general method of comparison.

In the case where the two ABMs have an overlap in their parameter space (i.e., they have some parameters in common), we can have a more detailed comparison. Let $\Xi_{c}$ be the parameters that the two ABMs have in common. We can partition this subspace of the parameter space into regions based on the most likely bin for $y$ for each parameter setting.
\begin{equation}
    B(\Xi_{c}) = \argmax_B \int_{\Xi \setminus \Xi_{c}} P(B|\Xi)P(\Xi \setminus \Xi_{c}),
\end{equation}
where $B$ denotes a bin, corresponding to the bin boundaries defined earlier, and $\Xi \setminus \Xi_{c}$ denotes the parameters other than the common parameters. The equation above assigns to each point in the common parameter subspace, a bin corresponding to the most likely output at that point.

Now we define the \emph{disagreement}, $\Delta$, between the two ABMs as the probability of choosing a parameter setting, according to the prior distribution, that results in a difference in the outputs of the two models.
\begin{equation}
    \Delta(F_1, F_2) = \int_{\Xi_{c}} \mathbf{1}(B_1(\Xi_{c}), B_2(\Xi_{c}))P_1(\Xi_{c}),
\end{equation}
where $\mathbf{1}(B_1(\Xi_{c}), B_2(\Xi_{c}))$ is an indicator function that is 1 if $B_1(\Xi_{c}) = B_2(\Xi_{c})$ and 0 otherwise. $\Delta$ gives the total probability, over the subspace $\Xi_c$, that the outputs of the two ABMs will fall into different bins. Note that $\Delta$ is a directed measure, since $\Delta(F_1, F_2) \ne \Delta(F_2, F_1)$.

There are various ways to compute the integral in equation~\ref{output_probability}. The typical approach in simulation
science is to use adaptive experiment designs [CITE]. Here we propose an approach based on active learning.